<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Badminton Manager - Practice</title>

  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
  <style>
    :root{
      --bg:#fdf4ff; --card:#ffffff; --text:#1f1029; --muted:#6b5a86;
      --primary:#d946ef; --accent:#9333ea; --danger:#dc2626;
      --warn:#d97706; --line:#e5e0eb;
    }
    :root.dark{
      --bg:#0b1020; --card:#12172a; --text:#e9efff; --muted:#9fb2d9;
      --primary:#a855f7; --accent:#ec4899; --danger:#ef4444;
      --warn:#f59e0b; --line:#293250;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font:14px/1.5 system-ui,Segoe UI,Roboto,Arial}
    body{background:var(--bg);color:var(--text);transition:background .3s,color .3s}
    .hidden{display:none}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:20px;box-shadow:0 4px 20px rgba(0,0,0,.12)}
    .btn{border:1px solid var(--line);background:transparent;padding:10px 14px;border-radius:10px;cursor:pointer}
    .btn.primary{background:linear-gradient(90deg,var(--primary),var(--accent));color:white;border-color:transparent;width:100%}
    .btn:hover{opacity:.9}
    .form-group { position: relative; margin: 16px 0; }
    .form-group input {
      width: 100%; padding: 14px 12px; border-radius: 10px;
      border: 1px solid var(--line); background: transparent; color: inherit; font-size: 1rem;
    }
    .form-group input:focus {
      outline: none; border-color: var(--primary);
      box-shadow: 0 0 0 3px color-mix(in oklab, var(--primary) 25%, transparent);
    }
    .form-group label {
      position: absolute; top: 14px; left: 12px; font-size: .9rem;
      color: var(--muted); pointer-events: none; transition: 0.25s ease;
      background: var(--card); padding: 0 4px; border-radius: 6px;
    }
    .form-group input:focus + label,
    .form-group input:not(:placeholder-shown) + label {
      top: -8px; left: 10px; font-size: .75rem; color: var(--primary);
    }
    #authView {display:flex; align-items:center; justify-content:center; height:100vh; padding:20px;}
    .auth-wrap {display:flex; align-items:center; justify-content:center; gap:40px; max-width:1000px; width:100%;}
    .auth-anim {flex:1; display:flex; align-items:center; justify-content:center;}
    .auth-anim lottie-player {width:100%; max-width:420px;}
    .auth-box { width:360px; flex-shrink:0; }
    .auth-tabs{display:flex;gap:8px;margin-bottom:12px}
    .auth-tabs .chip{flex:1;text-align:center;padding:10px;border-radius:12px;border:1px solid var(--line);cursor:pointer}
    .auth-tabs .chip.active{background:linear-gradient(90deg,var(--primary),var(--accent));color:#fff;border-color:transparent}
    #appView{display:none;flex-direction:column;height:100vh;width:100%}
    .topbar{background:var(--card);border-bottom:1px solid var(--line);padding:10px 16px;display:flex;justify-content:space-between;align-items:center}
    .tabs{display:flex;gap:8px;margin:0}
    .tabs .tab{padding:10px 12px;border:1px solid var(--line);border-bottom:2px solid transparent;border-radius:10px;cursor:pointer;background:transparent}
    .tabs .tab.active{border-bottom-color:var(--primary);box-shadow:inset 0 -2px 0 var(--primary);color:var(--primary)}
    .pane{flex:1;display:flex}
    .pane iframe{flex:1;border:none;background:var(--card)}
  </style>
</head>
<body>

<!-- AUTH -->
<div id="authView">
  <div class="auth-wrap">
    <div class="auth-anim">
      <lottie-player src="https://assets9.lottiefiles.com/packages/lf20_kyu7xb1v.json" background="transparent" speed="1" loop autoplay></lottie-player>
    </div>
    <div class="auth-box card">
      <div class="auth-tabs">
        <div id="tabSignIn" class="chip active">Sign In</div>
        <div id="tabSignUp" class="chip">Sign Up</div>
      </div>

      <!-- Sign In -->
      <div id="signInForm">
        <h2>Welcome Back 👋</h2>
        <p class="lead">Log in to continue managing your badminton tournaments.</p>
        <div class="form-group">
          <input id="username" type="text" placeholder=" "/>
          <label for="username">Username</label>
        </div>
        <div class="form-group">
          <input id="password" type="password" placeholder=" "/>
          <label for="password">Password</label>
        </div>
        <button id="signInBtn" class="btn primary">Sign In</button>
      </div>

      <!-- Sign Up -->
      <div id="signUpForm" class="hidden">
        <h2>Create Account ✨</h2>
        <p class="lead">Register below to get started with Badminton Manager.</p>
        <div class="form-group">
          <input id="newName" type="text" placeholder=" "/>
          <label for="newName">Name</label>
        </div>
        <div class="form-group">
          <input id="newEmail" type="email" placeholder=" "/>
          <label for="newEmail">Email</label>
        </div>
        <div class="form-group">
          <input id="newPass" type="password" placeholder=" "/>
          <label for="newPass">Password</label>
        </div>
        <div class="form-group">
          <input id="newPass2" type="password" placeholder=" "/>
          <label for="newPass2">Confirm Password</label>
        </div>
        <button id="signUpBtn" class="btn primary">Create Account</button>
      </div>
    </div>
  </div>
</div>

<!-- APP -->
<div id="appView">
  <div class="topbar">
    <div class="tabs">
      <div class="tab active" data-target="dashboard"><i class="fa fa-home"></i> Dashboard</div>
      <div class="tab" data-target="players"><i class="fa fa-users"></i> Players</div>
      <div class="tab" data-target="tournament"><i class="fa fa-trophy"></i> Tournament</div>
      <div class="tab" data-target="roundrobin"><i class="fa fa-layer-group"></i> Round Robin</div>
      <div class="tab" data-target="attendance"><i class="fa fa-check-square"></i> Attendance</div>
      <div class="tab" data-target="bracket"><i class="fa fa-sitemap"></i> Bracket</div>
    </div>
    <div style="display:flex;align-items:center;gap:8px">
      <span id="currentUser" style="font-size:13px;color:var(--muted)">Signed in</span>
      <button id="signOutBtn" class="btn">Sign Out</button>
      <button id="themeBtn" class="btn">🌓</button>
    </div>
  </div>
  <div class="pane"><iframe id="contentFrame"></iframe></div>
</div>

<div id="output" style="margin:10px; padding:10px; background:#fff; border:1px solid #ccc;">
  Waiting for backend response...
</div>

<script>
  const API_URL = "https://theworldofsportsmans.onrender.com/api";

  const authView = document.getElementById("authView");
  const appView = document.getElementById("appView");
  const tabs = document.querySelectorAll(".tab");
  const currentUser = document.getElementById("currentUser");

  // Tabs reference
  const tS=document.getElementById('tabSignIn');
  const tU=document.getElementById('tabSignUp');
  const fS=document.getElementById('signInForm');
  const fU=document.getElementById('signUpForm');

  // Toggle tab functions
  tS.onclick=()=>{
    tS.classList.add('active');
    tU.classList.remove('active');
    fS.classList.remove('hidden');
    fU.classList.add('hidden');
  };
  tU.onclick=()=>{
    tU.classList.add('active');
    tS.classList.remove('active');
    fU.classList.remove('hidden');
    fS.classList.add('hidden');
  };

  function doSignIn(u){
    authView.style.display='none';
    appView.style.display='flex';
    currentUser.textContent=`Signed in as ${u.username}`;
    loadTab('dashboard');
  }

  function doSignOut(){
    localStorage.removeItem("token");
    appView.style.display='none';
    authView.style.display='flex';
    document.getElementById('contentFrame').src='';
  }

  // Session check
  window.onload = async () => {
    const token = localStorage.getItem("token");
    if (token) {
      try {
        const res = await fetch(`${API_URL}/profile`, {
          headers: { "Authorization": "Bearer " + token }
        });
        if (res.ok) {
          const data = await res.json();
          doSignIn(data.user);
        } else {
          localStorage.removeItem("token");
        }
      } catch (err) {
        console.error("Session check failed:", err);
        localStorage.removeItem("token");
      }
    }
  };

  // Sign In
  document.getElementById('signInBtn').onclick=async ()=>{
    const uname=document.getElementById('username').value.trim();
    const pass=document.getElementById('password').value.trim();
    try {
      const res = await fetch(`${API_URL}/signin`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username: uname, password: pass })
      });
      const data = await res.json();
      if(res.ok){
        localStorage.setItem("token", data.token);
        doSignIn(data.user);
      } else {
        alert(data.msg);
      }
    } catch(err){
      alert("Server error, try again later");
    }
  };

  // Sign Up
  document.getElementById('signUpBtn').onclick=async ()=>{
    const n=document.getElementById('newName').value.trim();
    const e=document.getElementById('newEmail').value.trim();
    const p=document.getElementById('newPass').value.trim();
    const c=document.getElementById('newPass2').value.trim();

    if(!n||!e||!p){alert("Fill all fields");return;}
    if(p!==c){alert("Passwords do not match");return;}

    try {
      const res = await fetch(`${API_URL}/signup`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username:n, email:e, password:p })
      });
      const data = await res.json();
      if(res.ok){
        alert("✅ " + data.msg);
        // Clear form
        document.getElementById('newName').value="";
        document.getElementById('newEmail').value="";
        document.getElementById('newPass').value="";
        document.getElementById('newPass2').value="";
        // ✅ Switch back to SignIn tab directly
        tS.classList.add('active');
        tU.classList.remove('active');
        fS.classList.remove('hidden');
        fU.classList.add('hidden');
      } else {
        alert("⚠️ " + data.msg);
      }
    } catch(err){
      alert("Server error, try again later");
    }
  };

  document.getElementById('signOutBtn').onclick=doSignOut;

  tabs.forEach(tab => tab.onclick=()=>{
    tabs.forEach(t=>t.classList.remove('active'));
    tab.classList.add('active');
    loadTab(tab.dataset.target);
  });

  function loadTab(t){
    const FILES = {
      dashboard: "dashboard.html",
      players: "PlayerPage.html",
      tournament: "TournamentPage.html",
      roundrobin: "Round_Robin_updated.html",
      attendance: "Attendance_book.html",
      bracket: "Bracket_tournament.html",
    };
    if(FILES[t]) document.getElementById('contentFrame').src=FILES[t];
  }

  document.getElementById('themeBtn').onclick=()=>{
    document.documentElement.classList.toggle('dark');
  };

  // Test backend
  fetch(`${API_URL}/test`)
    .then(res => res.json())
    .then(data => {
      console.log("Response from backend:", data);
      document.getElementById("output").innerText = JSON.stringify(data);
    })
    .catch(err => console.error("Error:", err));
</script>
</body>
</html>
